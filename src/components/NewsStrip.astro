---
import { getCollection } from 'astro:content';

const allNews = await getCollection('news');
const items = allNews
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);
const formatter = new Intl.DateTimeFormat('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
const archiveHref = `${import.meta.env.BASE_URL}news/`;
---

{items.length > 0 && (
  <section class="news-strip" id="news" aria-label="Latest updates">
    <div class="news-strip__inner site-shell">
      <div class="news-strip__label">
        <span class="tag">Whatâ€™s new</span>
        <a href={archiveHref}>Archive</a>
      </div>
      <ol class="news-strip__items">
        {items.map((item) => (
          <li>
            <time dateTime={item.data.date}>{formatter.format(new Date(item.data.date))}</time>
            {item.data.link ? (
              <a href={item.data.link} target="_blank" rel="noopener noreferrer">
                {item.data.title}
              </a>
            ) : (
              <span>{item.data.title}</span>
            )}
          </li>
        ))}
      </ol>
    </div>
  </section>
)}
