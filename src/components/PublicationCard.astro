---
import type { CollectionEntry } from 'astro:content';

interface Props {
  entry: CollectionEntry<'publications'>;
  artifacts?: CollectionEntry<'artifacts'>[];
}

const { entry, artifacts = [] }: Props = Astro.props;
const { data, slug } = entry;
const detailHref = `${import.meta.env.BASE_URL}publications/${slug}/`;

const badges: { label: string; href?: string }[] = [
  { label: 'Paper', href: data.pdf ?? data.external ?? detailHref },
  { label: 'arXiv', href: data.arxiv },
  { label: 'Code', href: data.code },
  { label: 'Data', href: data.data },
  { label: 'Slides', href: data.slides },
];
---

<article class="card publication-card">
  <p class="publication-card__eyebrow">{data.venue} · {data.year}</p>
  {data.award && (
    <span class="card__award">{data.award}</span>
  )}
  <h3 class="publication-card__title">
    <a href={detailHref}>{data.title}</a>
  </h3>
  <p class="publication-card__authors">{data.authors.join(', ')}</p>

  {Array.isArray(data.tags) && data.tags.length > 0 && (
    <div class="card__tags">
      {data.tags.map((tag) => (
        <span class="card__tag">{tag}</span>
      ))}
    </div>
  )}

  <p class="publication-card__tldr">{data.tldr}</p>

  {badges.some((badge) => Boolean(badge.href)) && (
    <div class="card__links">
      {badges.map(
        (badge) =>
          badge.href && (
            <a
              class="card__link"
              href={badge.href}
              target="_blank"
              rel="noopener noreferrer"
            >
              {badge.label} ↗
            </a>
          ),
      )}
    </div>
  )}

  {artifacts.length > 0 && (
    <div class="card__links" style="border-top: none; padding-top: 0;">
      <span class="card__link" style="color: var(--color-text-soft);">
        Artifacts: {artifacts.map(a => a.data.name).join(', ')}
      </span>
    </div>
  )}
</article>

<style>
  .publication-card {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }
  
  .publication-card__eyebrow {
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--color-accent);
    margin: 0;
  }
  
  .publication-card__title {
    font-size: 1rem;
    font-weight: 600;
    margin: 0;
    line-height: 1.4;
  }
  
  .publication-card__title a {
    color: inherit;
  }
  
  .publication-card__title a:hover {
    color: var(--color-accent);
  }
  
  .publication-card__authors {
    font-size: 0.8rem;
    color: var(--color-text-soft);
    margin: 0;
  }
  
  .publication-card__tldr {
    font-size: 0.85rem;
    color: var(--color-text-muted);
    margin: var(--space-xs) 0 0;
    line-height: 1.6;
  }

  .card__award {
    display: inline-block;
    font-size: 0.75rem;
    font-weight: 600;
    color: var(--color-accent);
    background: var(--color-accent-soft);
    padding: 0.15rem 0.5rem;
    border-radius: var(--radius-pill);
    margin-top: var(--space-2xs);
  }
</style>
