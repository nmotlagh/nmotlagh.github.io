---
import type { CollectionEntry } from 'astro:content';

interface Props {
  entry: CollectionEntry<'publications'>;
  artifacts?: CollectionEntry<'artifacts'>[];
}

const { entry, artifacts = [] }: Props = Astro.props;
const rendered = await entry.render();
const { data, slug } = entry;
const detailHref = `${import.meta.env.BASE_URL}publications/${slug}/`;

const badges: { label: string; href?: string }[] = [
  { label: 'Paper', href: data.pdf ?? data.external ?? detailHref },
  { label: 'arXiv', href: data.arxiv },
  { label: 'Code', href: data.code },
  { label: 'Data', href: data.data },
  { label: 'Slides', href: data.slides },
];
---

<article class="publication-card card">
  <div class="publication-card__header">
    <div>
      <p class="publication-card__eyebrow">{data.venue} Â· {data.year}</p>
      <h3 class="publication-card__title">
        <a href={detailHref}>{data.title}</a>
      </h3>
      <p class="publication-card__authors">{data.authors.join(', ')}</p>
    </div>
    {data.metric && <span class="metric-chip">{data.metric}</span>}
  </div>

  {Array.isArray(data.tags) && data.tags.length > 0 && (
    <ul class="tag-list">
      {data.tags.map((tag) => (
        <li>{tag}</li>
      ))}
    </ul>
  )}

  <p class="publication-card__tldr">{data.tldr}</p>

  <slot name="body">
    <rendered.Content />
  </slot>

  {badges.some((badge) => Boolean(badge.href)) && (
    <div class="publication-card__badges" role="list">
      {badges.map(
        (badge) =>
          badge.href && (
            <a
              role="listitem"
              class="badge badge--link"
              href={badge.href}
              target="_blank"
              rel="noopener noreferrer"
            >
              {badge.label}
            </a>
          ),
      )}
    </div>
  )}

  {artifacts.length > 0 && (
    <div class="publication-card__artifacts">
      <span class="publication-card__artifacts-label">Artifacts</span>
      <ul>
        {artifacts.map((artifact) => (
          <li>
            <a href={artifact.data.repo} target="_blank" rel="noopener noreferrer">
              {artifact.data.name}
            </a>
          </li>
        ))}
      </ul>
    </div>
  )}
</article>
