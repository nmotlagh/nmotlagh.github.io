---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SectionHeading from '../../components/SectionHeading.astro';
import PublicationCard from '../../components/PublicationCard.astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';

const publications = (await getCollection('publications')).sort((a, b) => b.data.year - a.data.year);
const artifactEntries = await getCollection('artifacts');
const artifactMap = new Map<string, CollectionEntry<'artifacts'>[]>();
artifactEntries.forEach((artifact) => {
  artifact.data.tiesTo.forEach((slug) => {
    if (!artifactMap.has(slug)) {
      artifactMap.set(slug, []);
    }
    artifactMap.get(slug)?.push(artifact);
  });
});
---

<BaseLayout title="Publications" description="Research spanning selective prediction, multimodal machine translation, and dependable LLM systems.">
  <section class="site-shell section">
    <SectionHeading
      eyebrow="Research archive"
      title="Publications & Scholarly Articles"
      description="Every paper includes badges linking to the paper, arXiv, code, datasets, and slides where available. Keyboard-friendly navigation keeps the grid accessible."
    />
    <div class="publication-grid">
      {publications.map((pub) => (
        <PublicationCard entry={pub} artifacts={artifactMap.get(pub.slug)} />
      ))}
    </div>
  </section>
</BaseLayout>
