---
import BaseLayout from '../../layouts/BaseLayout.astro';
import SectionHeading from '../../components/SectionHeading.astro';
import { getCollection } from 'astro:content';

const artifacts = (await getCollection('artifacts')).sort((a, b) =>
  a.data.name.localeCompare(b.data.name),
);
const publications = await getCollection('publications');
const publicationLookup = new Map(publications.map((pub) => [pub.slug, pub.data.title]));
---

<BaseLayout title="Artifacts" description="Pinned GitHub repositories, datasets, and eval harnesses for every publication.">
  <section class="site-shell section">
    <SectionHeading
      eyebrow="Open source"
      title="Artifacts & GitHub repos"
      description="Recruiters and collaborators often want to see reproducibility at a glance. Each repo lists what you can run, the datasets you can download, and how it ties back to the paper above."
    />
    <div class="artifact-grid">
      {artifacts.map((artifact) => {
        const tiedPublications = artifact.data.tiesTo
          .map((slug) => ({ slug, title: publicationLookup.get(slug) }))
          .filter((item): item is { slug: string; title: string } => Boolean(item.title));
        return (
          <article class="artifact-card card">
            <div class="artifact-card__header">
              <h3>
                <a href={artifact.data.repo} target="_blank" rel="noopener noreferrer">
                  {artifact.data.name}
                </a>
              </h3>
              <a class="badge badge--link" href={artifact.data.repo} target="_blank" rel="noopener noreferrer">
                GitHub
              </a>
            </div>
            <p>{artifact.data.summary}</p>
            <ul>
              {artifact.data.reproduce.map((item) => (
                <li>{item}</li>
              ))}
            </ul>
            {tiedPublications.length > 0 && (
              <p class="artifact-card__ties">
                Supports:&nbsp;
                {tiedPublications.map((item, index) => (
                  <span>
                    <a href={`${import.meta.env.BASE_URL}publications/${item.slug}/`}>{item.title}</a>
                    {index < tiedPublications.length - 1 ? ', ' : ''}
                  </span>
                ))}
              </p>
            )}
          </article>
        );
      })}
    </div>
  </section>
</BaseLayout>
